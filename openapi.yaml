openapi: 3.1.0
info:
  title: MTG Deckbuilding API
  description: >
    Magic: The Gathering deckbuilding API with EDHRec, Moxfield, Commander Spellbook, cEDH database
    and EDHRec theme integration.  This API provides card search and autocomplete,
    commander summaries, deck validation, combo search, theme/tag browsing, competitive EDH
    database search, and popular deck discovery.
  version: "1.1.0"
servers:
  - url: https://mtg-mightstone-gpt.onrender.com
    description: Production deployment on Render
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key
  schemas:
    # existing schemas from original spec are reused below
    Card:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        mana_cost: { type: string, nullable: true }
        cmc: { type: number, nullable: true }
        type_line: { type: string, nullable: true }
        oracle_text: { type: string, nullable: true }
        colors:
          type: array
          items: { type: string }
          nullable: true
        color_identity:
          type: array
          items: { type: string }
          nullable: true
        rarity: { type: string, nullable: true }
        artist: { type: string, nullable: true }
        edhrec_rank: { type: integer, nullable: true }
        prices:
          type: object
          additionalProperties: true
          nullable: true

    CardSearchResponse:
      type: object
      properties:
        object: { type: string }
        total_cards: { type: integer }
        data:
          type: array
          items:
            $ref: '#/components/schemas/Card'

    AutoCompleteResponse:
      type: object
      properties:
        matches:
          type: array
          items: { type: string }

    CardListResponse:
      type: object
      properties:
        cards:
          type: array
          items: { type: string }

    CommanderCard:
      type: object
      properties:
        name: { type: string }
        num_decks: { type: integer, nullable: true }
        potential_decks: { type: integer, nullable: true }
        inclusion_percentage: { type: number, nullable: true }
        synergy_percentage: { type: number, nullable: true }
        sanitized_name: { type: string, nullable: true }
        card_url: { type: string, nullable: true }

    CommanderTag:
      type: object
      properties:
        tag: { type: string }
        count: { type: integer, nullable: true }
        link: { type: string, nullable: true }

    CommanderCombo:
      type: object
      properties:
        combo: { type: string }
        url: { type: string }

    SimilarCommander:
      type: object
      properties:
        name: { type: string }
        url: { type: string, nullable: true }

    CommanderSummary:
      type: object
      properties:
        commander_name: { type: string }
        commander_url: { type: string, nullable: true }
        timestamp: { type: string, format: date-time }
        commander_tags:
          type: array
          items: { type: string }
        top_10_tags:
          type: array
          items:
            $ref: '#/components/schemas/CommanderTag'
        all_tags:
          type: array
          items:
            $ref: '#/components/schemas/CommanderTag'
        combos:
          type: array
          items:
            $ref: '#/components/schemas/CommanderCombo'
        similar_commanders:
          type: array
          items:
            $ref: '#/components/schemas/SimilarCommander'
        categories:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/CommanderCard'

    ComboResult:
      type: object
      properties:
        combo_id: { type: string, nullable: true }
        combo_name: { type: string, nullable: true }
        color_identity:
          type: array
          items: { type: string }
        cards_in_combo:
          type: array
          items: { type: string }
        results_in_combo:
          type: array
          items: { type: string }
        decks_edhrec: { type: integer, nullable: true }
        variants: { type: integer, nullable: true }
        combo_url: { type: string, nullable: true }
        price_info:
          type: object
          additionalProperties: true
          nullable: true

    ComboSearchResponse:
      type: object
      properties:
        success: { type: boolean }
        commander_name: { type: string }
        search_query: { type: string }
        total_results: { type: integer }
        results:
          type: array
          items:
            $ref: '#/components/schemas/ComboResult'
        source_url: { type: string }
        timestamp: { type: string, format: date-time }

    ComboListResponse:
      type: object
      properties:
        combos:
          type: array
          items:
            $ref: '#/components/schemas/TwoCardCombo'
        total: { type: integer }
        combo_type: { type: string }
        timestamp: { type: string, format: date-time }

    TwoCardCombo:
      type: object
      properties:
        card1: { type: string }
        card2: { type: string }
        combo_type: { type: string, nullable: true }
        description: { type: string, nullable: true }

    ComboSearchByCardResponse:
      type: object
      properties:
        card_name: { type: string }
        combos_found:
          type: array
          items:
            $ref: '#/components/schemas/TwoCardCombo'
        total_combos: { type: integer }
        combo_type: { type: string }
        timestamp: { type: string, format: date-time }

    CommanderSaltResponse:
      type: object
      properties:
        commander_name: { type: string }
        salt_scores:
          type: object
          additionalProperties: true
        timestamp: { type: string, format: date-time }

    BracketsInfoResponse:
      type: object
      properties:
        brackets:
          type: array
          items:
            type: object
            properties:
              name: { type: string }
              description: { type: string }
              rules:
                type: array
                items: { type: string }
        timestamp: { type: string, format: date-time }

    GameChangersResponse:
      type: object
      properties:
        brackets:
          type: object
          additionalProperties:
            type: array
            items: { type: string }
        timestamp: { type: string, format: date-time }

    DeckValidationRequest:
      type: object
      properties:
        decklist:
          type: array
          items:
            type: string
          description: "List of card names in the deck."
        decklist_text:
          type: string
          nullable: true
          description: "Optional multi-line decklist text blob."
        decklist_chunks:
          type: array
          items:
            type: string
          nullable: true
          description: "Optional list of decklist text chunks."
        decklist_url:
          type: string
          nullable: true
          description: "Optional Moxfield or Archidekt deck URL."
        commander:
          type: string
          nullable: true
          description: "Commander name for explicit salt and legality lookup."
        target_bracket:
          type: string
          enum: [exhibition, core, upgraded, optimized, cedh]
          nullable: true
          description: "Target bracket (exhibition, core, upgraded, optimized, cedh)."
        validate_bracket:
          type: boolean
          default: true
          description: "Validate against bracket rules."
        validate_legality:
          type: boolean
          default: true
          description: "Validate Commander format legality."

    DeckCard:
      type: object
      properties:
        name: { type: string }
        quantity: { type: integer }
        is_game_changer: { type: boolean }
        bracket_categories:
          type: array
          items: { type: string }
        legality_status: { type: string }
        validation_issues:
          type: array
          items: { type: string }

    BracketValidation:
      type: object
      properties:
        target_bracket: { type: string }
        overall_compliance: { type: boolean }
        bracket_score: { type: integer, minimum: 1, maximum: 5 }
        compliance_details:
          type: object
          additionalProperties: true
        violations:
          type: array
          items: { type: string }
        recommendations:
          type: array
          items: { type: string }

    DeckValidationResponse:
      type: object
      properties:
        success: { type: boolean }
        deck_summary:
          type: object
          additionalProperties: true
        cards:
          type: array
          items:
            $ref: '#/components/schemas/DeckCard'
        bracket_validation:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/BracketValidation'
        legality_validation:
          type: object
          additionalProperties: true
        validation_timestamp: { type: string, format: date-time }
        errors:
          type: array
          items: { type: string }
        warnings:
          type: array
          items: { type: string }
        salt_scores:
          type: object
          additionalProperties: true

    DeckComboCheckResponse:
      type: object
      properties:
        combos_found:
          type: array
          items:
            $ref: '#/components/schemas/TwoCardCombo'
        total_combos: { type: integer }
        combo_type: { type: string }
        cards_checked: { type: integer }
        timestamp: { type: string, format: date-time }

    ExtendedComboCheckResponse:
      type: object
      properties:
        success: { type: boolean }
        cards_checked: { type: integer }
        total_combos_found: { type: integer }
        early_game_combos:
          type: object
          properties:
            count: { type: integer }
            combos:
              type: array
              items:
                $ref: '#/components/schemas/TwoCardCombo'
            acceptable_brackets:
              type: array
              items: { type: string }
        late_game_combos:
          type: object
          properties:
            count: { type: integer }
            combos:
              type: array
              items:
                $ref: '#/components/schemas/TwoCardCombo'
            acceptable_brackets:
              type: array
              items: { type: string }
        bracket_recommendation: { type: string }
        timestamp: { type: string, format: date-time }

    PageTheme:
      type: object
      properties:
        header: { type: string }
        description: { type: string }
        tags:
          type: array
          items: { type: string }
        source_url: { type: string }
        error: { type: string, nullable: true }
        container:
          type: object
          properties:
            collections:
              type: array
              items:
                $ref: '#/components/schemas/ThemeCollection'

    ThemeCollection:
      type: object
      properties:
        header: { type: string }
        items:
          type: array
          items:
            $ref: '#/components/schemas/ThemeItem'

    ThemeItem:
      type: object
      properties:
        name: { type: string }
        num_decks: { type: integer, nullable: true }
        sanitized_name: { type: string, nullable: true }
        card_url: { type: string, nullable: true }

    TagsAvailableResponse:
      type: object
      properties:
        success: { type: boolean }
        themes:
          type: array
          items: { type: string }
        count: { type: integer }
        color_identities:
          type: array
          items: { type: string }
        examples:
          type: array
          items:
            type: object
            additionalProperties: true
        usage:
          type: object
          additionalProperties: true
        source_url: { type: string }
        timestamp: { type: string, format: date-time }

    TagsCatalogResponse:
      type: object
      properties:
        success: { type: boolean }
        tags:
          type: array
          items: { type: string }
        count: { type: integer }
        color_identifiers:
          type: array
          items: { type: string }
        examples:
          type: array
          items:
            type: object
            additionalProperties: true
        usage:
          type: object
          additionalProperties: true
        timestamp: { type: string, format: date-time }

    CedhSearchResponse:
      type: object
      properties:
        total_results: { type: integer }
        filters_applied:
          type: object
          additionalProperties: true
        decks:
          type: array
          items:
            type: object
            additionalProperties: true

    CedhCommandersResponse:
      type: object
      properties:
        total_commanders: { type: integer }
        commanders:
          type: array
          items:
            type: object
            additionalProperties: true

    CedhStatsResponse:
      type: object
      properties:
        total_deck_archetypes: { type: integer }
        total_decklists: { type: integer }
        section_breakdown:
          type: object
          additionalProperties: { type: integer }
        color_identity_distribution:
          type: object
          additionalProperties: { type: integer }
        decks_with_primers: { type: integer }
        cache_status:
          type: object
          additionalProperties: true

    CedhInfoResponse:
      type: object
      properties:
        name: { type: string }
        version: { type: string }
        description: { type: string }
        database_source: { type: string }
        endpoints:
          type: object
          additionalProperties:
            type: object
            additionalProperties: true
        color_codes:
          type: object
          additionalProperties: { type: string }
        examples:
          type: array
          items: { type: string }

paths:
  /api/v1/status:
    get:
      summary: Get API status
      operationId: getApiStatus
      responses:
        '200':
          description: API status information
      security: []
  /:
    get:
      summary: Root endpoint
      operationId: getRoot
      responses:
        '200':
          description: API information
      security: []
  /health:
    get:
      summary: Health check
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
      security: []
  /api/v1/cards/search:
    post:
      summary: Search Magic cards
      description: Search MTG cards via Scryfall API with syntax support
      operationId: searchCards
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [query]
              properties:
                query: { type: string }
                order:
                  type: string
                  default: 'name'
                  enum: [name, set, released, rarity, color, usd, tix, eur, cmc, power, toughness, edhrec, penny, artist, review]
                unique:
                  type: string
                  default: 'cards'
                  enum: [cards, art, prints]
                page: { type: integer, default: 1, minimum: 1 }
                per_page: { type: integer, default: 20, minimum: 1, maximum: 175 }
      responses:
        '200':
          description: Matching cards
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardSearchResponse'
  /api/v1/cards/autocomplete:
    get:
      summary: Autocomplete card names
      description: Return a list of card names matching a given prefix.
      operationId: autocompleteCards
      security:
        - BearerAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Autocomplete suggestions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutoCompleteResponse'
  /api/v1/cards/random:
    get:
      summary: Get random Magic card
      operationId: getRandomCard
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Random card info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'
  /api/v1/cards/gamechangers:
    get:
      summary: List game‑changer cards
      description: Return a curated list of cards that significantly affect gameplay.
      operationId: getGameChangers
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Game‑changer cards
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardListResponse'
  /api/v1/cards/banned:
    get:
      summary: List banned cards
      description: Retrieve the list of cards banned in the Commander format.
      operationId: getBannedCards
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Banned cards
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardListResponse'
  /api/v1/cards/mass-land-destruction:
    get:
      summary: List mass land destruction cards
      description: Return cards that destroy many lands.
      operationId: getMassLandDestruction
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Mass land destruction cards
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardListResponse'
  /api/v1/cards/{card_id}:
    get:
      summary: Get card by ID
      operationId: getCardById
      security:
        - BearerAuth: []
      parameters:
        - name: card_id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Card details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'

  # Combo endpoints
  /api/v1/combos/late-game:
    get:
      summary: List all late-game combos
      description: Get complete list of 99 late-game two-card combos (brackets 3-5)
      operationId: getLateGameCombos
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Late-game combo list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboListResponse'
  /api/v1/combos/search-late-game:
    get:
      summary: Search late-game combos
      description: Search for late-game combos containing a specific card
      operationId: searchLateGameCombos
      security:
        - BearerAuth: []
      parameters:
        - name: card_name
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Matching late-game combos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboSearchByCardResponse'
  /api/v1/combos/early-game:
    get:
      summary: List all early-game combos
      description: Get complete list of 99 early-game two-card combos (brackets 4-5)
      operationId: getEarlyGameCombos
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Early-game combo list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboListResponse'
  /api/v1/combos/search-early-game:
    get:
      summary: Search early-game combos
      description: Search for early-game combos containing a specific card
      operationId: searchEarlyGameCombos
      security:
        - BearerAuth: []
      parameters:
        - name: card_name
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Matching early-game combos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboSearchByCardResponse'
  /api/v1/combos/commander/{commander_name}:
    get:
      summary: Get combos for a commander
      description: Retrieve combos involving a specific commander from Commander Spellbook.
      operationId: getCommanderCombos
      security:
        - BearerAuth: []
      parameters:
        - name: commander_name
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Combos for commander
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboSearchResponse'
  /api/v1/combos/search:
    get:
      summary: Search all combos by card
      description: Free-form combo search across both early and late-game combos.
      operationId: searchCombos
      security:
        - BearerAuth: []
      parameters:
        - name: card_name
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Matching combos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComboSearchByCardResponse'
  /api/v1/combos/info:
    get:
      summary: Combo API information
      description: Returns documentation and endpoints for combo API.
      operationId: getCombosInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Combo API information
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/v1/debug/combos/test:
    get:
      summary: Debug combo endpoint
      description: Internal testing endpoint for combos.
      operationId: debugComboTest
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Debug information
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  # Salt and bracket info
  /api/v1/salt/refresh:
    post:
      summary: Refresh salt cache
      description: Refresh the local EDHRec salt score cache manually
      operationId: refreshSaltCache
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Cache refresh status
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/v1/salt/info:
    get:
      summary: Get salt cache info
      description: Return cache status, card count, and last refresh time
      operationId: getSaltInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Cache information
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/v1/salt/card/{card_name}:
    get:
      summary: Get salt score for a card
      description: Retrieve salt score for a specific card with flexible name matching
      operationId: getSaltForCard
      security:
        - BearerAuth: []
      parameters:
        - name: card_name
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Salt data for the requested card
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/v1/deck/commander-salt/{commander_name}:
    get:
      summary: Get salt profile for a commander
      description: Retrieve aggregated salt scores for a given commander’s deck archetype.
      operationId: getCommanderSalt
      security:
        - BearerAuth: []
      parameters:
        - name: commander_name
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Commander salt profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommanderSaltResponse'
  /api/v1/brackets/info:
    get:
      summary: Get bracket information
      description: Returns descriptions and rules for commander brackets.
      operationId: getBracketsInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Bracket details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BracketsInfoResponse'
  /api/v1/brackets/game-changers/list:
    get:
      summary: List bracket game-changer cards
      description: Returns game‑changer cards grouped by bracket.
      operationId: getBracketsGameChangers
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Game‑changer cards by bracket
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameChangersResponse'

  # Deck validation and combo checks
  /api/v1/deck/validate:
    post:
      summary: Validate Commander deck
      description: Validate a Commander deck for bracket, legality, and salt scores
      operationId: validateDeck
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeckValidationRequest'
      responses:
        '200':
          description: Deck validation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeckValidationResponse'
  /api/v1/deck/validate/sample:
    get:
      summary: Get sample deck validation
      operationId: getSampleValidation
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Example validation output
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeckValidationResponse'
  /api/v1/deck/check-early-game-combos:
    post:
      summary: Check deck for early-game combos
      description: Check if a deck contains early-game two-card combos (brackets 4-5)
      operationId: checkEarlyGameCombos
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [cards]
              properties:
                cards:
                  type: array
                  items: { type: string }
      responses:
        '200':
          description: Early-game combos found in deck
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeckComboCheckResponse'
  /api/v1/deck/check-late-game-combos:
    post:
      summary: Check deck for late-game combos
      description: Check if a deck contains late-game two-card combos (brackets 3-5)
      operationId: checkLateGameCombos
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [cards]
              properties:
                cards:
                  type: array
                  items: { type: string }
      responses:
        '200':
          description: Late-game combos found in deck
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeckComboCheckResponse'
  /api/v1/deck/check-all-combos:
    post:
      summary: Check deck for all combos
      description: Comprehensive check for both early-game and late-game two-card combos
      operationId: checkAllCombos
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [cards]
              properties:
                cards:
                  type: array
                  items: { type: string }
      responses:
        '200':
          description: All combos found in deck
          content:
            application/json:
              schema:
                type: object
                properties:
                  early_game:
                    $ref: '#/components/schemas/DeckComboCheckResponse'
                  late_game:
                    $ref: '#/components/schemas/DeckComboCheckResponse'
                  total_combos: { type: integer }
                  timestamp: { type: string, format: date-time }
  /api/v1/deck/checkDeckAllCombos:
    post:
      summary: Flexible deck combo check
      description: Check deck for all combos with support for multiple JSON formats (cards list or object with card_names)
      operationId: checkDeckAllCombosFlexible
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            oneOf:
              - type: array
                items: { type: string }
              - type: object
                properties:
                  cards:
                    type: array
                    items: { type: string }
                  card_names:
                    type: array
                    items: { type: string }
      responses:
        '200':
          description: All combos found with flexible format support
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtendedComboCheckResponse'

  # Commander summary endpoints
  /api/v1/commander/summary:
    get:
      summary: Get commander summary
      description: Fetch EDHRec commander summary data with pagination and filtering.
      operationId: getCommanderSummary
      security:
        - BearerAuth: []
      parameters:
        - name: name
          in: query
          schema: { type: string }
          description: Commander name
        - name: commander_url
          in: query
          schema: { type: string }
          description: EDHRec commander URL
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 200, default: 40 }
          description: Maximum cards per category
        - name: categories
          in: query
          schema: { type: string }
          description: Comma-separated category filters
        - name: mode
          in: query
          schema: { type: string, enum: [standard, compact], default: standard }
          description: Response mode
      responses:
        '200':
          description: Commander summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommanderSummary'
  /api/v1/average_deck/summary:
    get:
      summary: Get average deck summary
      description: Fetch a summary of an EDHRec average deck page for a given commander.
      operationId: getAverageDeckSummary
      security:
        - BearerAuth: []
      parameters:
        - name: commander_name
          in: query
          schema: { type: string }
          description: Commander name
        - name: commander_slug
          in: query
          schema: { type: string }
          description: Pre-normalized commander slug
        - name: bracket
          in: query
          schema: { type: string }
          description: Bracket type (exhibition, core, upgraded, optimized, cedh)
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 200, default: 40 }
          description: Maximum cards per category
        - name: categories
          in: query
          schema: { type: string }
          description: Comma-separated category filters
        - name: mode
          in: query
          schema: { type: string, enum: [standard, compact], default: standard }
          description: Response mode
      responses:
        '200':
          description: Average deck summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommanderSummary'

  # Theme and tag endpoints
  /api/v1/tags/available:
    get:
      summary: Get available tags
      description: Fetch the complete list of available tags/themes from EDHRec.
      operationId: getAvailableTags
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Available themes/tags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagsAvailableResponse'
  /api/v1/themes/{theme_slug}:
    get:
      summary: Get theme data
      description: Fetch EDHRec theme or tag data for the given slug.
      operationId: getTheme
      security:
        - BearerAuth: []
      parameters:
        - name: theme_slug
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Theme page data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageTheme'
  /api/v1/tags/refresh-cache:
    post:
      summary: Refresh tags cache
      description: Refresh the EDHRec tags cache from the source.
      operationId: refreshTagsCache
      security:
        - BearerAuth: []
      parameters:
        - name: force_refresh
          in: query
          schema: { type: boolean, default: false }
          description: Force refresh even if cache is fresh
      responses:
        '200':
          description: Cache refresh result
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/v1/tags/catalog:
    get:
      summary: Get tags catalog
      description: Get the complete tags catalog with examples and usage info.
      operationId: getTagsCatalog
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Tags catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagsCatalogResponse'

  # cEDH database endpoints
  /api/v1/cedh/search:
    get:
      summary: Search cEDH database
      description: Search the competitive EDH decklist database with various filters.
      operationId: searchCedhDecks
      security:
        - BearerAuth: []
      parameters:
        - name: commander
          in: query
          schema: { type: string }
          description: Commander name (partial match)
        - name: colors
          in: query
          schema: { type: string }
          description: Exact color identity (e.g., "ub", "wubrg")
        - name: section
          in: query
          schema: { type: string }
          description: Section filter (COMPETITIVE, DEPRECATED, or BREW)
        - name: primer_only
          in: query
          schema: { type: boolean, default: false }
          description: Only return decks with primers
        - name: limit
          in: query
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
          description: Maximum number of results
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CedhSearchResponse'
  /api/v1/cedh/commanders:
    get:
      summary: List cEDH commanders
      description: Get a list of all commanders in the cEDH database with deck counts.
      operationId: listCedhCommanders
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Commander list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CedhCommandersResponse'
  /api/v1/cedh/stats:
    get:
      summary: Get cEDH database statistics
      description: Get statistics about the cEDH database including color distribution, section breakdown, and more.
      operationId: getCedhDatabaseStats
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Database statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CedhStatsResponse'
  /api/v1/cedh/info:
    get:
      summary: Get cEDH API information
      description: Get information about the cEDH database API endpoints and usage.
      operationId: getCedhApiInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CedhInfoResponse'

  # Popular decks endpoints
  /api/v1/popular-decks:
    get:
      summary: Get popular decks across all brackets
      description: Fetch top Commander decks from Moxfield and Archidekt without bracket filtering.  When the `commander` query parameter is provided, results are limited to Moxfield.
      operationId: getAllPopularDecks
      security:
        - BearerAuth: []
      parameters:
        - name: limit_per_source
          in: query
          schema:
            type: integer
            default: 5
            minimum: 1
            maximum: 20
          description: Number of decks per source (default 5, max 20)
        - name: commander
          in: query
          schema: { type: string }
          description: Optional commander name to filter results
      responses:
        '200':
          description: Popular decks with bracket information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopularDecksResponse'
  /api/v1/popular-decks/info:
    get:
      summary: Get popular decks API info
      description: Returns supported brackets, endpoint documentation, and usage examples
      operationId: getPopularDecksInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: API information and supported brackets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopularDecksInfoResponse'
  /api/v1/popular-decks/{bracket}:
    get:
      summary: Get popular decks for specific bracket
      description: Fetch top Commander decks filtered by power level bracket.  When a `commander` is specified, results come only from Moxfield.
      operationId: getPopularDecksByBracket
      security:
        - BearerAuth: []
      parameters:
        - name: bracket
          in: path
          required: true
          schema:
            type: string
            enum: [exhibition, core, upgraded, optimized, cedh]
          description: Commander bracket (exhibition, core, upgraded, optimized, cedh)
        - name: limit_per_source
          in: query
          schema:
            type: integer
            default: 5
            minimum: 1
            maximum: 20
          description: Number of decks per source (default 5, max 20)
        - name: commander
          in: query
          schema: { type: string }
          description: Optional commander name to filter results
      responses:
        '200':
          description: Popular decks for specified bracket
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopularDecksResponse'
